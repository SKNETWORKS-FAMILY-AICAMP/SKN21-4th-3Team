#!/bin/bash
# ===========================================
# AI 상담 챗봇 - 배포 스크립트
# ===========================================
#
# 사용법:
#   ./deploy.sh
#
# ===========================================
set -e

echo "========================================"
echo "  배포 시작"
echo "========================================"

cd /home/ec2-user/SKN21-4th-3Team

# -------------------------------------------------------------
# 1. 최신 코드 Pull
# -------------------------------------------------------------
echo ""
echo "[1/4] 최신 코드 업데이트..."
git pull origin main

# -------------------------------------------------------------
# 2. 가상환경 활성화
# -------------------------------------------------------------
echo ""
echo "[2/4] 가상환경 활성화..."
source venv/bin/activate

# -------------------------------------------------------------
# 3. 의존성 업데이트
# -------------------------------------------------------------
echo ""
echo "[3/4] 의존성 업데이트..."
pip install -r requirements.txt --quiet

# -------------------------------------------------------------
# 4. 서비스 재시작
# -------------------------------------------------------------
echo ""
echo "[4/4] 서비스 재시작..."
sudo systemctl restart mindcare

# 상태 확인
sleep 3
sudo systemctl status mindcare --no-pager

echo ""
echo "========================================"
echo "  배포 완료!"
echo "========================================"
echo ""
echo "로그 확인: sudo journalctl -u mindcare -f"
echo ""
